// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  MANAGER
  BRANCH_MANAGER
  CONSULTANT
}

enum ListingStatus {
  FOR_SALE
  FOR_RENT
}

enum ListingCategory {
  HOUSING
  LAND
  COMMERCIAL
  TRANSFER
  FIELD
  GARDEN
  HOBBY_GARDEN
}

enum RequestStatus {
  NEW
  IN_PROGRESS
  CLOSED
}

enum CustomerRequestType {
  SELL
  RENT
  VALUATION
}

model User {
  id           String      @id @default(cuid())
  email        String      @unique
  passwordHash String
  name         String
  role         Role
  isActive     Boolean     @default(true)
  consultant   Consultant?
  listings     Listing[]   @relation("ListingsCreatedBy")
  consultantRequestsCreated ConsultantRequest[] @relation("ConsultantRequestsCreatedBy")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Consultant {
  id              String   @id @default(cuid())
  userId          String   @unique
  branchId        String
  photoUrl        String?
  title           String?
  whatsappNumber  String?
  contactPhone    String?
  bio             String?
  user            User     @relation(fields: [userId], references: [id])
  branch          Branch   @relation(fields: [branchId], references: [id])
  listings        Listing[]
  requests        ConsultantRequest[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Branch {
  id        String      @id @default(cuid())
  name      String
  slug      String      @unique
  cityId    String
  address   String?
  city      City        @relation(fields: [cityId], references: [id])
  listings  Listing[]
  staff     Consultant[]
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
}

model City {
  id            String        @id @default(cuid())
  name          String
  slug          String        @unique
  districts     District[]
  neighborhoods Neighborhood[]
  branches      Branch[]
  listings      Listing[]
  customerRequests CustomerRequest[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model District {
  id            String         @id @default(cuid())
  name          String
  slug          String
  cityId        String
  city          City           @relation(fields: [cityId], references: [id])
  neighborhoods Neighborhood[]
  listings      Listing[]
  customerRequests CustomerRequest[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([cityId])
  @@unique([cityId, slug])
}

model Neighborhood {
  id         String   @id @default(cuid())
  name       String
  slug       String
  cityId     String
  districtId String
  city       City     @relation(fields: [cityId], references: [id])
  district   District @relation(fields: [districtId], references: [id])
  listings   Listing[]
  customerRequests CustomerRequest[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([cityId, districtId])
  @@unique([districtId, slug])
}

model Listing {
  id              String          @id @default(cuid())
  title           String
  description     String
  status          ListingStatus
  category        ListingCategory
  propertyType    String?
  price           Decimal?        @db.Decimal(12, 2)
  currency        String          @default("TRY")
  areaGross       Decimal?        @db.Decimal(10, 2)
  areaNet         Decimal?        @db.Decimal(10, 2)
  latitude        Decimal?        @db.Decimal(9, 6)
  longitude       Decimal?        @db.Decimal(9, 6)
  attributes      Json?
  isOpportunity   Boolean         @default(false)
  branchId        String
  cityId          String
  districtId      String?
  neighborhoodId  String?
  consultantId    String?
  createdByUserId String
  publishedAt     DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  branch          Branch          @relation(fields: [branchId], references: [id])
  city            City            @relation(fields: [cityId], references: [id])
  district        District?       @relation(fields: [districtId], references: [id])
  neighborhood    Neighborhood?   @relation(fields: [neighborhoodId], references: [id])
  consultant      Consultant?     @relation(fields: [consultantId], references: [id])
  createdBy       User            @relation("ListingsCreatedBy", fields: [createdByUserId], references: [id])
  images          ListingImage[]

  @@index([status, cityId])
  @@index([branchId])
}

model ListingImage {
  id        String   @id @default(cuid())
  listingId String
  url       String
  isCover   Boolean  @default(false)
  sortOrder Int      @default(0)
  listing   Listing  @relation(fields: [listingId], references: [id])
  createdAt DateTime @default(now())
}

model CustomerRequest {
  id           String              @id @default(cuid())
  fullName     String
  phone        String
  email        String?
  type         CustomerRequestType
  criteria     Json?
  notes        String?
  status       RequestStatus       @default(NEW)
  cityId       String?
  districtId   String?
  neighborhoodId String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  city         City?               @relation(fields: [cityId], references: [id])
  district     District?           @relation(fields: [districtId], references: [id])
  neighborhood Neighborhood?       @relation(fields: [neighborhoodId], references: [id])

  @@index([status])
}

model ConsultantRequest {
  id               String        @id @default(cuid())
  consultantId     String
  createdByUserId  String
  customerName     String
  customerPhone    String
  customerEmail    String?
  requestText      String?
  criteria         Json?
  matchedListingIds Json?
  status           RequestStatus @default(NEW)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  consultant       Consultant    @relation(fields: [consultantId], references: [id])
  createdBy        User          @relation("ConsultantRequestsCreatedBy", fields: [createdByUserId], references: [id])

  @@index([consultantId, status])
}

model SiteSetting {
  id              String   @id @default("default")
  siteName        String
  logoUrl         String?
  ownerName       String?
  ownerTitle      String?
  phoneNumber     String?
  whatsappNumber  String?
  email           String?
  supportEmail    String?
  primaryColor    String?
  accentColor     String?
  backgroundColor String?
  textColor       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
