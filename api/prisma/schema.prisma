// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  MANAGER
  BRANCH_MANAGER
  CONSULTANT
}

enum ListingStatus {
  FOR_SALE
  FOR_RENT
}

enum ListingCategory {
  HOUSING
  LAND
  COMMERCIAL
  TRANSFER
  FIELD
  GARDEN
  HOBBY_GARDEN
}

enum ListingAttributeType {
  TEXT
  NUMBER
  SELECT
  BOOLEAN
}

enum RequestStatus {
  NEW
  IN_PROGRESS
  CLOSED
}

enum CustomerRequestType {
  SELL
  RENT
  VALUATION
}

model User {
  id           String      @id @default(cuid())
  email        String      @unique
  passwordHash String
  name         String
  role         Role
  isActive     Boolean     @default(true)
  consultant   Consultant?
  listings     Listing[]   @relation("ListingsCreatedBy")
  consultantRequestsCreated ConsultantRequest[] @relation("ConsultantRequestsCreatedBy")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Consultant {
  id              String   @id @default(cuid())
  userId          String   @unique
  branchId        String
  photoUrl        String?
  title           String?
  whatsappNumber  String?
  contactPhone    String?
  bio             String?
  user            User     @relation(fields: [userId], references: [id])
  branch          Branch   @relation(fields: [branchId], references: [id])
  listings        Listing[]
  requests        ConsultantRequest[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Branch {
  id             String      @id @default(cuid())
  name           String
  slug           String      @unique
  cityId         String
  address        String?
  photoUrl       String?
  phone          String?
  whatsappNumber String?
  email          String?
  city           City        @relation(fields: [cityId], references: [id])
  listings       Listing[]
  staff          Consultant[]
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
}

model City {
  id            String        @id @default(cuid())
  name          String
  slug          String        @unique
  districts     District[]
  neighborhoods Neighborhood[]
  branches      Branch[]
  listings      Listing[]
  customerRequests CustomerRequest[]
  cityButtons   CityButton[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model District {
  id            String         @id @default(cuid())
  name          String
  slug          String
  cityId        String
  city          City           @relation(fields: [cityId], references: [id])
  neighborhoods Neighborhood[]
  listings      Listing[]
  customerRequests CustomerRequest[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([cityId])
  @@unique([cityId, slug])
}

model Neighborhood {
  id         String   @id @default(cuid())
  name       String
  slug       String
  cityId     String
  districtId String
  city       City     @relation(fields: [cityId], references: [id])
  district   District @relation(fields: [districtId], references: [id])
  listings   Listing[]
  customerRequests CustomerRequest[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([cityId, districtId])
  @@unique([districtId, slug])
}

model Listing {
  id              String          @id @default(cuid())
  title           String
  description     String
  status          ListingStatus
  category        ListingCategory
  propertyType    String?
  price           Decimal?        @db.Decimal(12, 2)
  currency        String          @default("TRY")
  areaGross       Decimal?        @db.Decimal(10, 2)
  areaNet         Decimal?        @db.Decimal(10, 2)
  latitude        Decimal?        @db.Decimal(9, 6)
  longitude       Decimal?        @db.Decimal(9, 6)
  attributes      Json?
  isOpportunity   Boolean         @default(false)
  branchId        String
  cityId          String
  districtId      String?
  neighborhoodId  String?
  consultantId    String?
  createdByUserId String
  publishedAt     DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // SEO Fields
  slug            String?         @unique
  seoUrl          String?
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  canonicalUrl    String?
  ogImage         String?

  branch          Branch          @relation(fields: [branchId], references: [id])
  city            City            @relation(fields: [cityId], references: [id])
  district        District?       @relation(fields: [districtId], references: [id])
  neighborhood    Neighborhood?   @relation(fields: [neighborhoodId], references: [id])
  consultant      Consultant?     @relation(fields: [consultantId], references: [id])
  createdBy       User            @relation("ListingsCreatedBy", fields: [createdByUserId], references: [id])
  images          ListingImage[]

  @@index([status, cityId])
  @@index([branchId])
  @@index([slug])
}

model ListingAttributeDefinition {
  id         String               @id @default(cuid())
  category   ListingCategory
  key        String
  label      String
  type       ListingAttributeType
  options    Json?
  allowsMultiple Boolean          @default(false)
  isRequired Boolean              @default(false)
  sortOrder  Int                  @default(0)
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt

  @@unique([category, key])
  @@index([category, sortOrder])
}

model ListingImage {
  id        String   @id @default(cuid())
  listingId String
  url       String
  isCover   Boolean  @default(false)
  sortOrder Int      @default(0)
  listing   Listing  @relation(fields: [listingId], references: [id])
  createdAt DateTime @default(now())
}

model CustomerRequest {
  id           String              @id @default(cuid())
  fullName     String
  phone        String
  email        String?
  type         CustomerRequestType
  criteria     Json?
  notes        String?
  status       RequestStatus       @default(NEW)
  cityId       String?
  districtId   String?
  neighborhoodId String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  city         City?               @relation(fields: [cityId], references: [id])
  district     District?           @relation(fields: [districtId], references: [id])
  neighborhood Neighborhood?       @relation(fields: [neighborhoodId], references: [id])

  @@index([status])
}

model ConsultantRequest {
  id               String        @id @default(cuid())
  consultantId     String
  createdByUserId  String
  customerName     String
  customerPhone    String
  customerEmail    String?
  requestText      String?
  criteria         Json?
  matchedListingIds Json?
  status           RequestStatus @default(NEW)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  consultant       Consultant    @relation(fields: [consultantId], references: [id])
  createdBy        User          @relation("ConsultantRequestsCreatedBy", fields: [createdByUserId], references: [id])

  @@index([consultantId, status])
}

model SiteSetting {
  id              String   @id @default("default")
  siteName        String
  logoUrl         String?
  ownerName       String?
  ownerTitle      String?
  showOwnerTitle  Boolean  @default(true)
  phoneNumber     String?
  whatsappNumber  String?
  email           String?
  supportEmail    String?
  address         String?
  primaryColor    String?
  accentColor     String?
  backgroundColor String?
  textColor       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Banner/Hero section customization
  heroBackgroundUrl   String?
  heroOverlayColor    String?
  heroOverlayOpacity  Float?
  bannerWidth         Int?
  bannerHeight        Int?
  bannerOpacity       Float?

  // Logo customization
  logoWidth           Int?
  logoHeight          Int?
  logoPositionX       Int?
  logoPositionY       Int?
  logoTagline         String?
  logoTaglineFont     String?
  logoTaglineFontSize Int?
  logoTaglineColor    String?

  // Logo subtitle (separate from owner info)
  logoSubtitleText     String?
  logoSubtitleFont     String?
  logoSubtitleFontSize Int?
  logoSubtitleColor    String?
  logoSubtitleBgColor  String?
  showLogoSubtitle     Boolean @default(true)

  // Profile section customization
  profileImageUrl     String?
  profileImageWidth   Int?
  profileImageHeight  Int?
  profilePositionX    Int?
  profilePositionY    Int?
  profileOpacity      Float?
  profileTitleLabel   String?
  profileTitleFont    String?
  profileTitleSize    Int?
  profileTitleColor   String?
  profileNameFont     String?
  profileNameSize     Int?
  profileNameColor    String?

  // Social links
  instagramUrl        String?
  facebookUrl         String?
  youtubeUrl          String?
  twitterUrl          String?
  linkedinUrl         String?

  // Header customization
  headerBgColor       String?
  headerBgGradient    String?
  headerBgImage       String?
  headerBgOpacity     Float?
  headerNavFont       String?
  headerNavFontSize   Int?
  headerNavColor      String?

  // Footer customization
  footerBgColor       String?
  footerBgGradient    String?
  footerBgImage       String?
  footerBgOpacity     Float?
  footerTextColor     String?
  footerFont          String?
  footerFontSize      Int?

  // Main content background
  mainBgColor         String?
  mainBgImage         String?
  mainBgOpacity       Float?

  // Homepage city buttons customization
  homeCityBtnWidth       Int?
  homeCityBtnHeight      Int?
  homeCityBtnGap         Int?
  homeCityBtnBorderRadius Int?
  homeCityBtnAlign       String?

  // Homepage action buttons customization
  homeActionBtnWidth       Int?
  homeActionBtnHeight      Int?
  homeActionBtnGap         Int?
  homeActionBtnBorderRadius Int?
  homeActionBtnFontSize    Int?

  // City button text customization
  cityBtnTitleColor     String?
  cityBtnTitleSize      Int?
  cityBtnTitleFont      String?
  cityBtnSubtitleColor  String?
  cityBtnSubtitleSize   Int?
  
  // City button badge
  cityBtnBadgeText      String?
  cityBtnBadgeColor     String?
  cityBtnBadgeBgColor   String?
  cityBtnBadgeIcon      String?
  cityBtnShowBadge      Boolean @default(true)
  
  // Section titles
  sectionTitleColor     String?
  sectionTitleFont      String?
  sectionTitleSize      Int?
  branchSectionTitle    String?
  recentListingsTitle   String?
  
  // View all button
  viewAllBtnText        String?
  viewAllBtnBgColor     String?
  viewAllBtnTextColor   String?
  
  // Footer content
  footerLogoSubtitle    String?
  footerAddress         String?
  footerAddress2        String?
  footerPhone           String?
  footerPhone2          String?
  footerEmail           String?
  footerWorkingHours    String?
  footerCopyright       String?
  footerShowMap         Boolean @default(false)
  footerMapUrl          String?

  // Mobile Settings
  mobileHeaderPadding        String?
  mobileNavFontSize          Int?
  mobileLogoRowPadding       String?
  mobileLogoHeight           Int?
  mobileLogoSubSize          Int?
  mobileLogoAlign            String?
  mobileSocialSize           Int?
  mobileSocialShow           Boolean @default(true)
  mobileSearchWidth          Int?
  mobileSearchHeight         Int?
  mobileSearchShow           Boolean @default(true)
  mobileBannerHeight         Int?
  mobileBannerAspectRatio    String?
  mobileBannerFullWidth      Boolean @default(true)
  mobileBannerBorderRadius   Int?
  mobileBranchColumns        Int?
  mobileBranchGap            Int?
  mobileBranchSize           Int?
  mobileBranchBorderRadius   Int?
  mobileBranchAlign          String?
  mobileActionColumns        Int?
  mobileActionGap            Int?
  mobileActionHeight         Int?
  mobileActionFontSize       Int?
  mobileActionBorderRadius   Int?
  mobileListingColumns       Int?
  mobileListingGap           Int?
}

// Dynamic footer items - for multiple addresses, phones, etc.
model FooterItem {
  id         String   @id @default(cuid())
  type       String   // address, phone, email, map, text, link
  label      String?
  value      String
  linkUrl    String?
  icon       String?  // Font Awesome icon class
  iconColor  String?
  textColor  String?
  sortOrder  Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// Listing labels/badges for custom tags
model ListingLabel {
  id              String   @id @default(cuid())
  name            String
  slug            String   @unique
  textColor       String   @default("#ffffff")
  bgColor         String   @default("#10b981")
  borderRadius    Int      @default(4)
  isRounded       Boolean  @default(false)
  sortOrder       Int      @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model CityButton {
  id             String   @id @default(cuid())
  name           String
  slug           String   @unique
  imageUrl       String?
  icon           String?  // Font Awesome icon class e.g. "fa-solid fa-building"
  iconColor      String?
  bgColor        String?
  borderColor    String?
  width          Int?
  height         Int?
  sortOrder      Int      @default(0)
  isActive       Boolean  @default(true)
  cityId         String?
  // Branch contact info
  address        String?
  phone          String?
  whatsappNumber String?
  email          String?
  consultantName String?
  latitude       Float?
  longitude      Float?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  city           City?    @relation(fields: [cityId], references: [id])

  @@index([sortOrder])
}

model Banner {
  id          String   @id @default(cuid())
  title       String?
  imageUrl    String
  linkUrl     String?
  position    String   @default("home-top")
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  startDate   DateTime?
  endDate     DateTime?
  width       Int?
  height      Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([position, isActive, sortOrder])
}

model ActionButton {
  id          String   @id @default(cuid())
  name        String
  linkUrl     String
  imageUrl    String?
  bgColor     String?
  textColor   String?
  icon        String?
  width       Int?
  height      Int?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive, sortOrder])
}

model PageSetting {
  id              String   @id @default(cuid())
  slug            String   @unique
  title           String
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  ogImage         String?
  content         Json?
  isPublished     Boolean  @default(true)
  showInMenu      Boolean  @default(true)
  menuOrder       Int      @default(0)
  template        String   @default("default")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([isPublished, menuOrder])
}

model BlogPost {
  id              String   @id @default(cuid())
  slug            String   @unique
  title           String
  excerpt         String?
  content         String?
  coverImage      String?
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  isPublished     Boolean  @default(false)
  publishedAt     DateTime?
  showOnHome      Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([isPublished, publishedAt])
}

model MenuItem {
  id        String   @id @default(cuid())
  label     String
  href      String
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  textColor String?
  bgColor   String?
  icon      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive, sortOrder])
}

model PageDesign {
  id              String   @id @default(cuid())
  pageType        String   @unique // home, listings, listing-detail, etc.
  pageName        String
  // Header settings
  headerBgColor   String?
  headerBgGradient String?
  headerBgImage   String?
  headerNavColor  String?
  headerNavFont   String?
  headerNavFontSize Int?
  showHeader      Boolean  @default(true)
  // Footer settings
  footerBgColor   String?
  footerBgGradient String?
  footerBgImage   String?
  footerTextColor String?
  footerFont      String?
  footerFontSize  Int?
  showFooter      Boolean  @default(true)
  // Content area settings
  contentBgColor  String?
  contentBgImage  String?
  contentPadding  Int?
  contentMaxWidth Int?
  // Banner settings
  showBanner      Boolean  @default(false)
  bannerHeight    Int?
  bannerBgColor   String?
  bannerBgImage   String?
  // SEO settings
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  seoUrl          String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model SocialLink {
  id        String   @id @default(cuid())
  label     String
  url       String
  icon      String   @default("fa-solid fa-link")
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive, sortOrder])
}
